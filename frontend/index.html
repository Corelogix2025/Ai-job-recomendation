<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>AI Job Recommender</title>

    <!-- Static CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

    <div class="container">
        <h1>AI Job Recommender</h1>

        <form id="resumeForm">
            <input type="file" id="resume" accept=".pdf" required>
            <button type="submit">Find Best Jobs</button>
        </form>

        <p id="status"></p>
    </div>

    <script>
        /* üî• FIREBASE CONFIG (YOUR PROJECT) */
        const firebaseConfig = {
            apiKey: "AIzaSyApIFWYjxtL-taAem3ddARVr3kwoe-Bedg",
            authDomain: "ai-job-ba0f5.firebaseapp.com",
            databaseURL: "https://ai-job-ba0f5-default-rtdb.firebaseio.com",
            projectId: "ai-job-ba0f5",
            storageBucket: "ai-job-ba0f5.firebasestorage.app",
            messagingSenderId: "816955655434",
            appId: "1:816955655434:web:5719896ea02674290366f3",
            measurementId: "G-ZV2W9JPVLB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Get database reference
        const database = firebase.database();

        const form = document.getElementById("resumeForm");
        const statusText = document.getElementById("status");

        form.addEventListener("submit", async(e) => {
            e.preventDefault();

            const fileInput = document.getElementById("resume");
            if (!fileInput.files.length) {
                alert("Please upload a resume PDF");
                return;
            }

            statusText.innerText = "üì° Fetching jobs from Firebase & analyzing resume...";

            // OPTIONAL: Fetch jobs from Firebase (frontend-ready)
            database.ref("jobs").once("value")
                .then(snapshot => {
                    const jobs = snapshot.val();

                    // Store jobs locally (can be used later)
                    localStorage.setItem("jobs", JSON.stringify(jobs));

                    statusText.innerText = "‚úÖ Jobs loaded from Firebase";

                    // üëâ Resume processing still goes to backend
                    uploadResume(fileInput.files[0]);
                })
                .catch(err => {
                    console.error(err);
                    statusText.innerText = "‚ùå Failed to fetch jobs from Firebase";
                });
        });

        async function uploadResume(file) {
            const formData = new FormData();
            formData.append("resume", file);

            try {
                const response = await fetch(
                    "https://ai-job-recomendation.onrender.com/analyze", {
                        method: "POST",
                        body: formData
                    }
                );

                const data = await response.json();

                localStorage.setItem("resultData", JSON.stringify(data));
                window.location.href = "result.html";

            } catch (error) {
                console.error(error);
                statusText.innerText = "‚ùå Server error";
            }
        }
    </script>

</body>

</html>